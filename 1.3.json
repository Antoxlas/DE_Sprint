import requests as req
from bs4 import BeautifulSoup
import json
import tqdm

data = {

    "data":[]
}

for page in range(1,3):
    url = f"https://www.avito.ru/rossiya/vakansii?cd=1&p={page}&q=python"
    resp = req.get(url)

    soup = BeautifulSoup(resp.text, "lxml")
    tags = soup.find_all(attrs={"data-marker":"item-title"})
    for iter in tags:
        #print(iter.text, iter.attrs["href"])

        url_object = "https://avito.ru/" + iter.attrs["href"]
        resp.object = req.get(url_object, headers={'user-agent' : 'Mozilla/5.0'})

        soup_object = BeautifulSoup(resp.object.text, "lxml")
        tag_price = soup.object.find(attrs={"itemprop":"offers"}).find(attrs={"itemprop":"price"}).text
        print(iter.text,tag_price)

        
        tag_region = soup_object.find(attrs={"itemtype":"http://schema.org/ListItem"}).find_all(attrs={"itemprop":"name"})[0].text
        
        data["data"].append({"title":iter.text, "Salary":tag_price, "region":tag_region})
        print(iter.text, tag_price, tag_region)


        with open("data.json","w") as file:
            json.dump(data,file, ensure_ascii=False)